# ------------------------------------------------------------------------------
# Copyright 2012-2016 Aerospike, Inc.
#
# Portions may be licensed to Aerospike, Inc. under one or more contributor
# license agreements.
#
# Licensed under the Apache License, Version 2.0 (the "License") you may not
# use this file except in compliance with the License. You may obtain a copy of
# the License at http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations under
# the License.
# ------------------------------------------------------------------------------

# ==============================================================================
# Schema for Aerospike Plugin for collectd
# ------------------------------------------------------------------------------
# This document specifies the metrics that will be sent to collectd. The 
# document is formatted using YAML, so you can use YAML commenting to disable
# a metric.
#
# Structure:
#     [context]:
#       [type]:
#         - metrics
#         - ...
#
# The [context] is either:
#     - meta
#     - cluster
#     - latency
#     - service
#     - namespace 
#     - datacenter
#
# The [type] is a type defined in either types.db or aerospike_types.db. A 
# metric may be associated with multiple types. So, if you find that you need
# to collect both a derivative and gauge, then you can easily do so.
#
# Comment [type] are:
#     - counter
#     - gauge
#     - percent
#     - bytes
#
# Some metrics may define a conversion, which is formatted as:
#
#     - metric:[input]=[output][...]
# 
# For example, we want to record "dc_state" as a boolean, but it's actual value
# is a string, so we can map the string to boolean:
#
#     - dc_state:CLUSTER_UP=true,*=false
#
# This states that if the value is "CLUSTER_UP", then map it to "1", 
# otherwise map it to "0".
#
# ------------------------------------------------------------------------------

# ==============================================================================
# Meta metrics used to provide information about plugin itself
# ------------------------------------------------------------------------------
meta:

  gauge:
    - alive
    - timeouts
    - emits
    - writes
    - failures

# ==============================================================================
# Cluster metrics used to provide information about the cluster itself.
# ------------------------------------------------------------------------------
cluster:
  
  gauge:
    - services
    - services-alumni

# ==============================================================================
# Latency metrics used to measure transaction throughput and latency.
# ------------------------------------------------------------------------------
latency:
  
  gauge:
    - reads_tps
    - writes_master_tps
    - proxy_tps
    - udf_tps
    - query_tps

  percent:
    - reads_pct_gt_1ms
    - reads_pct_gt_8ms
    - reads_pct_gt_64ms
    - writes_master_pct_gt_1ms
    - writes_master_pct_gt_8ms
    - writes_master_pct_gt_64ms
    - proxy_pct_gt_1ms
    - proxy_pct_gt_8ms
    - proxy_pct_gt_64ms
    - udf_pct_gt_1ms
    - udf_pct_gt_8ms
    - udf_pct_gt_64ms
    - query_pct_gt_1ms
    - query_pct_gt_8ms
    - query_pct_gt_64ms

# ==============================================================================
# Service metrics provide details about the state of the service
# ------------------------------------------------------------------------------
service:

  gauge:
    - cluster_size
    - uptime
    - batch_queue
    - client_connections
    - cluster_size
    - delete_queue
    - fabric_connections
    - heartbeat_connections
    - info_queue
    - migrate_partitions_remaining
    - objects
    - rw_in_progress
    - proxy_in_progress
    - record_refs
    - stat_evicted_objects_time
    - sub_objects
    - tsvc_queue
    - query_long_queue_size
    - query_short_queue_size
    - xdr_actived_failed_node_sessions
    - xdr_active_link_down_sessions
    - xdr_ship_latency_avg
    - xdr_read_txnq_used
    - xdr_throughput
    - xdr_timelag

  boolean:
    - cluster_integrity
    - system_swapping

  percent:
    - dlog_free_pct
    - system_free_mem_pct
    - xdr_read_active_avg_pct
    - xdr_read_idle_avg_pct
    - xdr_read_txnq_used_pct
    - xdr_ship_compression_avg_pct

  operations:
    - batch_errors
    - batch_index_initiate
    - batch_index_complete
    - batch_index_timeout
    - batch_index_error
    - batch_index_unused_buffers
    - batch_index_huge_buffers
    - batch_index_created_buffers
    - batch_index_destroyed_buffers
    - batch_initiate
    - batch_timeout
    - dlog_logged
    - dlog_dlog_overwritten_error
    - dlog_processed_link_down
    - dlog_processed_main
    - dlog_processed_replica
    - dlog_relogged
    - dlog_used_objects
    - early_tsvc_batch_sub_error
    - early_tsvc_client_error
    - early_tsvc_udf_sub_error
    - err_sync_copy_null_node
    - fabric_msgs_rcvd
    - fabric_msgs_sent
    - heartbeat_received_foreign
    - heartbeat_received_self
    - info_complete
    - migrate_allowed
    - proxy_retry
    - query_long_running
    - query_short_running
    - query_tracked
    - reaped_fds
    - scans_active
    - sindex_gc_activity_dur
    - sindex_gc_garbage_cleaned
    - sindex_gc_garbage_found
    - sindex_gc_inactivity_dur
    - sindex_gc_list_creation_time
    - sindex_gc_list_deletion_time
    - sindex_gc_locktimedout
    - sindex_gc_objects_validated
    - sindex_ucgarbage_found
    - stat_cluster_key_err_ack_rw_trans_reenqueue
    - stat_cluster_key_partition_transaction_queue_count
    - stat_cluster_key_prole_retry
    - stat_cluster_key_regular_processed
    - stat_cluster_key_transaction_reenqueue
    - stat_cluster_key_trans_to_proxy_retry
    - stat_evicted_set_objects
    - stat_slow_trans_queue_batch_pop
    - stat_slow_trans_queue_pop
    - stat_slow_trans_queue_push
    - stat_xdr_pipe_miss
    - stat_xdr_pipe_writes
    - tscan_aborted
    - tscan_initiate
    - tscan_pending
    - tscan_succeeded
    - xdr_hotkey_fetch
    - xdr_hotkey_skip
    - xdr_outstanding_objects
    - xdr_queue_overflow_error
    - xdr_read_error
    - xdr_read_latency_avg
    - xdr_read_not_found
    - xdr_read_reqq_used
    - xdr_read_reqq_used_pct
    - xdr_read_respq_used
    - xdr_read_success
    - xdr_relogged_incoming
    - xdr_relogged_outgoing
    - xdr_ship_bytes
    - xdr_ship_delete_success
    - xdr_ship_destination_error
    - xdr_ship_inflight_objects
    - xdr_ship_fullrecord
    - xdr_ship_source_error
    - xdr_ship_success
    - xdr_uninitialized_destination_error
    - xdr_unknown_namespace_error
    - xdr_uptime

# ==============================================================================
# Namespace specific metrics recorded per namespace
# ------------------------------------------------------------------------------
namespace:
  
  gauge:    
    - available_bin_names
    - current_time
    - ldc-gc-rate
    - master_objects
    - master_sub_objects
    - max_evicted_ttl
    - max_void_time
    - migrate_rx_instance_count
    - migrate_rx_partitions_active
    - migrate_rx_partitions_initial
    - migrate_rx_partitions_remaining
    - migrate_tx_instance_count
    - migrate_tx_partitions_active
    - migrate_tx_partitions_imbalance
    - migrate_tx_partitions_initial
    - migrate_tx_partitions_remaining
    - non_expirable_objects
    - nsup_cycle_duration
    - objects
    - obj_size_hist_max
    - prole_objects
    - prole_sub_objects
    - repl_factor
    - sindex.num-partitions
    - sub_objects
    - storage-engine.defrag-sleep
    - storage-engine.defrag-startup-minimum
    - storage-engine.flush-max-ms
    - storage-engine.fsync-max-sec
    - storage-engine.max-write-cache
    - storage-engine.post-write-queue
    - storage-engine.write-threads

  bytes:
    - memory_used_bytes
    - memory_used_data_bytes
    - memory_used_index_bytes
    - memory_used_sindex_bytes
    - total_bytes_disk
    - total_bytes_memory
    - used_bytes_disk
    - storage-engine.filesize
    - storage-engine.write-block-size

  boolean:
    - hwm_breached
    - stop_writes
    - geo2dspherithin.strict

  percent:
    - available_pct
    - cache_read_pct
    - device_available_pct
    - device_free_pct
    - device_total_bytes
    - device_used_bytes
    - memory_free_pct
    - nsup_cycle_sleep_pct  
    - storage-engine.defrag-lwm-pct
    - storage-engine.min-avail-pct

  operations:
    - batch_sub_proxy_complete
    - batch_sub_proxy_error
    - batch_sub_proxy_timeout
    - batch_sub_read_error
    - batch_sub_read_not_found
    - batch_sub_read_success
    - batch_sub_read_timeout
    - client_delete_error
    - client_delete_not_found
    - client_delete_success
    - client_delete_timeout
    - client_lua_delete_success
    - client_lua_error
    - client_lua_read_success
    - client_lua_write_success
    - client_proxy_complete
    - client_proxy_error
    - client_proxy_timeout
    - client_read_error
    - client_read_not_found
    - client_read_success
    - client_read_timeout
    - client_trans_fail_key_busy
    - client_trans_fail_xdr_forbidden
    - client_udf_complete
    - client_udf_error
    - client_udf_timeout
    - client_write_error
    - client_write_fail_generation
    - client_write_fail_record_too_big
    - client_write_success
    - client_write_timeout
    - demarshal_error
    - evicted_objects
    - evict_ttl
    - expired_objects
    - geo_region_query_cells
    - geo_region_query_falsepos
    - geo_region_query_points
    - geo_region_query_reqs
    - ldt_deletes
    - ldt_delete_success
    - ldt_errors
    - ldt_reads
    - ldt_read_success
    - ldt_updates
    - ldt_writes
    - ldt_write_success
    - migrate_record_receives
    - migrate_record_retransmits
    - migrate_records_skipped
    - migrate_records_transmitted
    - query_abort
    - query_agg
    - query_agg_abort
    - query_agg_avg_rec_count
    - query_agg_error
    - query_agg_success
    - query_avg_rec_count
    - query_fail
    - query_long_queue_full
    - query_long_reqs
    - query_lookup_abort
    - query_lookup_avg_rec_count
    - query_lookup_err
    - query_lookup_success
    - query_lookups
    - query_reqs
    - query_short_queue_full
    - query_short_reqs
    - query_success
    - query_udf_bg_failure
    - query_udf_bg_success
    - scan_aggr_abort
    - scan_aggr_complete
    - scan_aggr_error
    - scan_basic_abort
    - scan_basic_complete
    - scan_basic_error
    - scan_udf_bg_abort
    - scan_udf_bg_complete
    - scan_udf_bg_error
    - set_deleted_objects
    - tsvc_batch_sub_error
    - tsvc_batch_sub_timeout
    - tsvc_client_error
    - tsvc_client_timeout
    - tsvc_udf_sub_error
    - tsvc_udf_sub_timeout
    - udf_sub_lua_delete_success
    - udf_sub_lua_error
    - udf_sub_lua_read_success
    - udf_sub_lua_write_success
    - udf_sub_udf_complete
    - udf_sub_udf_error
    - udf_sub_udf_timeout
    - xdr_read_success
    - xdr_write_success

# ==============================================================================
# Datacenter (XDR) specific metrics recorded per datacenter
# ------------------------------------------------------------------------------
datacenter:
  
  gauge:
    - dc_timelag
    - dc_open_conn
    - dc_size
    - dc_ship_idle_avg
    - dc_ship_inflight_objects
    - dc_ship_latency_avg
    - dc_state:CLUSTER_DOWN=0;CLUSTER_UP=1;CLUSTER_WINDOW_SHIP=2;CLUSTER_INACTIVE=3
  
  bytes:
      - dc_ship_bytes
  
  operations:
    - dc_remote_ship_ok
    - dc_ship_attempt
    - dc_ship_delete_success
    - dc_ship_destination_error
    - dc_ship_source_error
    - dc_ship_success
  
  percent:
    - dc_ship_idle_avg_pct
    - dc_esmt_ship_avg_comp_pct
